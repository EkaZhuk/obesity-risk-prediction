# -*- coding: utf-8 -*-
"""Многоклассовое_прогнозирование_риска_ожирения_1.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/17BWcsbPP03zYAymuyqorvmaWCXMnIVDl
"""

import pandas as pd
data = pd.read_csv('ObesityDataSet.csv')
print("Данные успешно загружены!")
print(f"Размер таблицы: {data.shape[0]} строк, {data.shape[1]} столбцов")

data.head()

print("=== ИНФОРМАЦИЯ О СТОЛБЦАХ ===")
data.info()

#  целевая переменная - риск ожирения
print("=== РАСПРЕДЕЛЕНИЕ РИСКА ОЖИРЕНИЯ ===")
print(data['NObeyesdad'].value_counts())

#  график
import matplotlib.pyplot as plt
import seaborn as sns

plt.figure(figsize=(10, 6))
data['NObeyesdad'].value_counts().plot(kind='bar')
plt.title('Распределение категорий риска ожирения')
plt.xticks(rotation=45)
plt.show()

print("=== ПРОПУЩЕННЫЕ ДАННЫЕ ===")
print(data.isnull().sum())

print("\n=== ПРОПУСКИ В ПРОЦЕНТАХ ===")
print((data.isnull().sum() / len(data)) * 100)

print("=== СТАТИСТИКА ЧИСЛОВЫХ ПРИЗНАКОВ ===")
data.describe()

print("=== КАТЕГОРИАЛЬНЫЕ ПРИЗНАКИ ===")
categorical_columns = ['Gender', 'family_history_with_overweight', 'FAVC', 'CAEC', 'SMOKE', 'SCC', 'CALC', 'MTRANS']

for column in categorical_columns:
    print(f"\n--- {column} ---")
    print(data[column].value_counts())

# график распределения веса
plt.figure(figsize=(12, 6))

# Гистограмма веса
plt.subplot(1, 2, 1)
plt.hist(data['Weight'], bins=30, alpha=0.7, color='skyblue')
plt.title('Распределение Веса')
plt.xlabel('Вес (кг)')
plt.ylabel('Количество людей')

# График роста vs вес
plt.subplot(1, 2, 2)
plt.scatter(data['Height'], data['Weight'], alpha=0.5, c='green')
plt.title('Рост vs Вес')
plt.xlabel('Рост (м)')
plt.ylabel('Вес (кг)')

plt.tight_layout()
plt.show()

# визуализация для категориальных признаков
fig, axes = plt.subplots(2, 4, figsize=(20, 10))
axes = axes.ravel()

categorical_columns = ['Gender', 'family_history_with_overweight', 'FAVC', 'CAEC', 'SMOKE', 'SCC', 'CALC', 'MTRANS']

for i, column in enumerate(categorical_columns):
    data[column].value_counts().plot(kind='bar', ax=axes[i], color='lightcoral')
    axes[i].set_title(f'{column}')
    axes[i].tick_params(axis='x', rotation=45)

plt.tight_layout()
plt.show()

# как вес связан с категориями риска ожирения
plt.figure(figsize=(12, 6))
sns.boxplot(data=data, x='NObeyesdad', y='Weight')
plt.title('Распределение веса по категориям риска ожирения')
plt.xticks(rotation=45)
plt.show()

# как категории риска связаны с полом и семейной историей
print("=== СВЯЗЬ РИСКА ОЖИРЕНИЯ С ПОЛОМ ===")
pd.crosstab(data['NObeyesdad'], data['Gender'])

print("=== СВЯЗЬ РИСКА ОЖИРЕНИЯ С СЕМЕЙНОЙ ИСТОРИЕЙ ===")
pd.crosstab(data['NObeyesdad'], data['family_history_with_overweight'])

#  тепловая карта корреляций для числовых признаков
plt.figure(figsize=(12, 8))

# только числовые столбцы
numeric_data = data.select_dtypes(include=['float64'])

#  корреляции
correlation_matrix = numeric_data.corr()

#  тепловая карта
sns.heatmap(correlation_matrix, annot=True, cmap='coolwarm', center=0)
plt.title('Корреляция между числовыми признаками')
plt.show()

print("=== ВЫВОДЫ ИЗ РАЗВЕДОЧНОГО АНАЛИЗА ===")
print("Сильные стороны данных:")
print("   - Нет пропущенных значений")
print("   - Сбалансированная целевая переменная")
print("   - Хороший объем данных (2111 наблюдений)")
print("   - Разнообразные признаки (анкета образа жизни)")

print("Ключевые наблюдения:")
print("   - 81.7% имеют семейную историю ожирения")
print("   - 88.4% часто употребляют высококалорийную пищу")
print("   - Только 4.5% следят за калориями")
print("   - Сильная корреляция ожидается между Weight и категориями риска")

# БЕЙЗЛАЙН МОДЕЛЬ ДЛЯ КЛАССИФИКАЦИИ
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LogisticRegression
from sklearn.metrics import accuracy_score, classification_report
from sklearn.preprocessing import LabelEncoder, StandardScaler

print("=== ПОДГОТОВКА ДАННЫХ ДЛЯ МОДЕЛИ ===")

# копия данных чтобы не испортить оригинал
data_encoded = data.copy()

# категориальные переменные
label_encoders = {}
categorical_columns = ['Gender', 'family_history_with_overweight', 'FAVC', 'CAEC',
                      'SMOKE', 'SCC', 'CALC', 'MTRANS', 'NObeyesdad']

for column in categorical_columns:
    le = LabelEncoder()
    data_encoded[column] = le.fit_transform(data_encoded[column])
    label_encoders[column] = le

# разделение на признаки (X) и целевую переменную (y)
X = data_encoded.drop('NObeyesdad', axis=1)
y = data_encoded['NObeyesdad']

# разделение на тренировочную и тестовую выборки
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

print(f"Тренировочная выборка: {X_train.shape}")
print(f"Тестовая выборка: {X_test.shape}")

# МАСШТАБИРОВАНИЕ ЧИСЛОВЫХ ПРИЗНАКОВ
scaler = StandardScaler()
X_train_scaled = scaler.fit_transform(X_train)
X_test_scaled = scaler.transform(X_test)

print("=== ОБУЧЕНИЕ БЕЙЗЛАЙН МОДЕЛИ ===")
#  логистическая регрессия как бейзлайн для классификации
baseline_model = LogisticRegression(random_state=42, max_iter=1000)
baseline_model.fit(X_train_scaled, y_train)

# Предсказания
y_pred = baseline_model.predict(X_test_scaled)

# Оценка качества
accuracy = accuracy_score(y_test, y_pred)
print(f"Точность бейзлайн модели: {accuracy:.4f}")

!pip install ydata_profiling

import pandas as pd
from ydata_profiling import ProfileReport

# 1. Загрузка файла 'ObesityDataSet.csv'
df_train = pd.read_csv('ObesityDataSet.csv')

# 2. Генерация отчёта
profile = ProfileReport(
    df_train,
    title="EDA Отчет ObesityDataSet.csv",
    explorative=True
)

# 3. Вывод отчета на экран (в виде интерактивного виджета)
profile